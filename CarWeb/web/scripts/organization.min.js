var _ORG_TREE_NODE_PREFIX="_ORG_";var _ORG_ADD_CHILD_NODE_FUNC="add_child_org";var _ORG_EDIT_NODE_FUNC="edit_org";var _ORG_REMOVE_NODE_FUNC="remove_org";var _ORG_GENERATE_START_ID=-423;function organizationChildrenInArray(b,d){if(b&&d){if(in_array(b.id,d)){return 1}if(b.children&&b.children.length>0){for(var a=0;a<b.children.length;a++){var c=organizationChildrenInArray(b.children[a],d);if(c>0){return 2}}}}return 0}function Organization(e,b,a,d,c){this.id=e;this.name=b;this.channels=a;this.userCount=d;this.selected=c;this.children=[]}function OrganizationUtils(){this.autoOrganizationId=_ORG_GENERATE_START_ID;this.openToSelected=true;this.organizationList=[];this.selectedOrganization=[];this.initByJson=function(b){var c=JSON.parse(b);if(!c){return}function g(o,k,h){if(o){if(o.children){for(var j=0;j<o.children.length;j++){var m=o.children[j];if(m){var l=new Organization(m.id,m.name,m.channels,m.count,in_array(m.id,h));if(m.children&&m.children.length>0){g(m,l,h)}if(k){k.children.push(l)}}}}}}for(var f=0;f<c.length;f++){var e=c[f];if(e){var d=new Organization(e.id,e.name,e.channels,e.count,in_array(e.id,this.selectedOrganization));if(e.children&&e.children.length>0){g(e,d,this.selectedOrganization)}this.organizationList.push(d)}}};this.setSelectedOrganization=function(b){this.selectedOrganization=(""+b).split(",")};var a=function(j,h,b,f){for(var c=0;c<j.children.length;c++){var g=j.children[c];var d=(g.children&&g.children.length>0)?"folder":"item";h[_ORG_TREE_NODE_PREFIX+g.id]={name:g.name,type:d,id:g.id};if(d=="item"&&in_array(g.id,b)){h[_ORG_TREE_NODE_PREFIX+g.id]["additionalParameters"]={"item-selected":true}}else{if(d=="folder"){h[_ORG_TREE_NODE_PREFIX+g.id]["additionalParameters"]={};var e=organizationChildrenInArray(g,b);if(e==1){h[_ORG_TREE_NODE_PREFIX+g.id]["additionalParameters"]["item-selected"]=true}else{if(e==2&&f){h[_ORG_TREE_NODE_PREFIX+g.id]["additionalParameters"]["item-opened"]=true}}h[_ORG_TREE_NODE_PREFIX+g.id]["additionalParameters"]["children"]={};a(g,h[_ORG_TREE_NODE_PREFIX+g.id]["additionalParameters"]["children"],b)}}}};this.generateTreeData=function(){var g=this.organizationList;if(g.length==0){return null}var c={};for(var b=0;b<g.length;b++){var e=g[b];var d=(e.children&&e.children.length>0)?"folder":"item";c[_ORG_TREE_NODE_PREFIX+e.id]={name:e.name,type:d,id:e.id};if(d=="item"&&in_array(e.id,this.selectedOrganization)){c[_ORG_TREE_NODE_PREFIX+e.id]["additionalParameters"]={"item-selected":true}}else{if(d=="folder"){c[_ORG_TREE_NODE_PREFIX+e.id]["additionalParameters"]={};var f=organizationChildrenInArray(e,this.selectedOrganization);if(f==1){c[_ORG_TREE_NODE_PREFIX+e.id]["additionalParameters"]["item-selected"]=true}else{if(f==2&&this.openToSelected){c[_ORG_TREE_NODE_PREFIX+e.id]["additionalParameters"]["item-opened"]=true}}c[_ORG_TREE_NODE_PREFIX+e.id]["additionalParameters"]["children"]={};a(e,c[_ORG_TREE_NODE_PREFIX+e.id]["additionalParameters"]["children"],this.selectedOrganization,this.openToSelected)}}}return new DataSourceTree({data:c})};this.generateFilterTree=function(){if(this.organizationList.length<=1){return this.generateTreeData()}var c=[];var d=new Organization(-1,"所有组织","",9999,false);for(var b=0;b<this.organizationList.length;b++){d.children.push(this.organizationList[b])}c.push(d);return this.generateTreeData(c)};this.generateNestableData=function(){var d=function(h){if(h&&h.children&&h.children.length>0){b+='<ol class="bb-list">';for(var f=0;f<h.children.length;f++){var g=h.children[f];if(g){b+='<li class="bb-item" data-id="'+g.id+'" data-name="'+encodeURI(g.name)+'" data-channels="'+g.channels+'" data-user-count="'+g.userCount+'">';b+='<div class="bb-handle"><span>'+g.name+'</span><div class="pull-right action-buttons"><a class="green" href="#" title="添加子组织" onclick="'+_ORG_ADD_CHILD_NODE_FUNC+"("+g.id+');return false;"><i class="ace-icon fa fa-plus bigger-130"></i></a><a class="blue" href="#" title="编辑组织" onclick="'+_ORG_EDIT_NODE_FUNC+"("+g.id+');return false;"><i class="ace-icon fa fa-pencil bigger-130"></i></a><a class="red" href="#" title="删除组织" onclick="'+_ORG_REMOVE_NODE_FUNC+"("+g.id+');return false;"><i class="ace-icon fa fa-trash-o bigger-130"></i> </a></div>';b+="</div>";if(g.children&&g.children.length>0){d(g)}b+="</li>"}}b+="</ol>"}};var b='<ol class="bb-list">';for(var c=0;c<this.organizationList.length;c++){var e=this.organizationList[c];if(e){b+='<li class="bb-item" data-id="'+e.id+'" data-name="'+encodeURI(e.name)+'" data-channels="'+e.channels+'" data-user-count="'+e.userCount+'">';b+='<div class="bb-handle"><span>'+e.name+'</span><div class="pull-right action-buttons"><a class="green" href="#" title="添加子组织" onclick="'+_ORG_ADD_CHILD_NODE_FUNC+"("+e.id+')"><i class="ace-icon fa fa-plus bigger-130"></i></a><a class="blue" href="#" title="编辑组织" onclick="'+_ORG_EDIT_NODE_FUNC+"("+e.id+');return false;"><i class="ace-icon fa fa-pencil bigger-130"></i></a><a class="red" href="#" title="删除组织" onclick="'+_ORG_REMOVE_NODE_FUNC+"("+e.id+');return false;"><i class="ace-icon fa fa-trash-o bigger-130"></i> </a></div>';b+="</div>";if(e.children&&e.children.length>0){d(e)}b+="</li>"}}b+="</ol>";return b};this.generateNewOrganization=function(d,e,b){var c='<li class="bb-item" data-id="'+this.autoOrganizationId+'"  data-name="'+encodeURI(e)+'" data-channels="'+b+'" data-user-count="0"><div class="bb-handle"><span>'+e+'</span><div class="pull-right action-buttons"><a class="green" href="#" title="添加子组织" onclick="'+_ORG_ADD_CHILD_NODE_FUNC+"("+this.autoOrganizationId+');return false;"><i class="ace-icon fa fa-plus bigger-130"></i></a><a class="blue" href="#" title="编辑组织" onclick="'+_ORG_EDIT_NODE_FUNC+"("+this.autoOrganizationId+');return false;"><i class="ace-icon fa fa-pencil bigger-130"></i></a><a class="red" href="#" title="删除组织" onclick="'+_ORG_REMOVE_NODE_FUNC+"("+this.autoOrganizationId+');return false;"><i class="ace-icon fa fa-trash-o bigger-130"></i> </a></div>';c+="</div></li>";this.autoOrganizationId--;return c};this.addChild=function(b,d){var c=this.findOrganization(b);if(!c){return null}var e=new Organization(this.autoOrganizationId,d,false);c.children.push(e);return e};this.findOrganization=function(f){var c=function(l,k){if(!l){return null}if(l.children&&l.children.length>0){for(var g=0;g<l.children.length;g++){var j=l.children[g];if(!j){continue}if(j.id==k){return j}else{if(j.children&&j.children.length>0){var h=c(j,k);if(h){return h}}}}}return null};for(var b=0;b<this.organizationList.length;b++){var e=this.organizationList[b];if(e){if(e.id==f){return e}else{if(e.children&&e.children.length>0){var d=c(e,f);if(d){return d}}}}}return null};this.getFirstLevelOrg=function(){if(this.organizationList){return(this.organizationList.length>1)?this.organizationList:this.organizationList[0].children}}};